[% EDITWARNMAP %]
[% PROCESS "brb.map-inc" -%]
#
# Start of map file
#
# Generated for
#   MAPSERVER_VERSION=      [% MAPSERVER_VERSION %]
#   NEED_PNG_NOALPHA_HACK=  [% NEED_PNG_NOALPHA_HACK %]
#   IMAGE_TYPE=             [% IMAGE_TYPE %]
#   IMAGE_SUFFIX=           [% IMAGE_SUFFIX %]
#   MAPSERVER_DRIVER=       [% MAPSERVER_DRIVER %]
#   TRANSPARENT=            [% TRANSPARENT %]
#   SMALL_SCREEN=           [% SMALL_SCREEN %]
#
MAP

NAME [% MAPNAME %]
STATUS ON
SIZE [% IMGWIDTH %] [% IMGHEIGHT %]
EXTENT [% EXTENT %]
UNITS METERS
SHAPEPATH "[% MAPSERVER_DIR %]/data"
IMAGECOLOR [% IMAGECOLOR %]
FONTSET "[% MAPSERVER_DIR %]/[% FONTS_LIST %]"

[%
  IF MAPSERVER_VERSION < 7 ;
    SET ENABLE_ANNOTATION_LAYERS = 1;
  ELSE;
    SET ENABLE_ANNOTATION_LAYERS = 0;
  END;
-%]

[%
  IF MAPSERVER_VERSION >= 6 ;
    SET ADVANCED_MOUNT_SYMBOLS = 1;
  ELSE;
    SET ADVANCED_MOUNT_SYMBOLS = 0;
  END;
-%]

[%# NOTE: IMAGE_SUFFIX => type of *input* images -%]
[%#       IMAGE_TYPE   => type of *output* image -%]
[% IF NEED_PNG_NOALPHA_HACK %]
# you may need to change this to match your MapServer build
[% UNLESS IMAGE_TYPE.defined; IMAGE_TYPE = "png"; END -%]
[%# some (all?) GD versions cannot handle alpha channels well ... -%]
[% IF IMAGE_SUFFIX == "png"; SET NOALPHA = "_noalpha"; ELSE; SET NOALPHA = ""; END -%]
[% SET TRANSPARENCY_ALPHA = "" -%]
IMAGETYPE [% IMAGE_TYPE %]

[% ELSE %]

OUTPUTFORMAT
  NAME png
  MIMETYPE image/png
[% IF MAPSERVER_DRIVER == "AGG" -%]
  DRIVER AGG/PNG
[% ELSE -%]
  DRIVER GD/PNG
[% END -%]
  EXTENSION png
[% IF TRANSPARENT.defined && TRANSPARENT -%]
  IMAGEMODE RGBA
  TRANSPARENT TRUE
[% ELSE -%]
  IMAGEMODE RGB
  TRANSPARENT FALSE
[% END -%]
END
IMAGETYPE png

[%
  IF MAPSERVER_VERSION >= 7;
    SET TRANSPARENCY_ALPHA = "COMPOSITE\n  OPACITY 100\nEND";
    SET TRANSPARENCY_HALF  = "COMPOSITE\n  OPACITY 50\nEND";
  ELSE;
    SET TRANSPARENCY_ALPHA = "TRANSPARENCY ALPHA";
    SET TRANSPARENCY_HALF  = "TRANSPARENCY 50";
  END
-%]

[% END %]

#
# Start of web interface definition (including WMS enabling metadata)
#
WEB
  HEADER query_header.html
  TEMPLATE [% TEMPLATE %].html
  FOOTER query_footer.html
  MINSCALEDENOM 1000
  MAXSCALEDENOM 750000
  IMAGEPATH "[% MAPSERVER_DIR %]/tmp/"
  IMAGEURL "[% MAPSERVER_RELURL %]/tmp/"
  EMPTY "[% MAPSERVER_RELURL %]/empty.html"
  METADATA
    WMS_TITLE "BBBike Berlin/Brandenburg"
    WMS_ABSTRACT "Eine radfahrerorientierte Karte von Berlin und Brandenburg"
    WMS_ACCESSCONSTRAINTS "none"

    # change this value to match your setup
    WMS_ONLINERESOURCE "[% MAPSERVER_URL %]/brb_init.html"

    WMS_SRS "EPSG:4326"
  END
END

QUERYMAP
  SIZE 200 200
  STATUS OFF
  STYLE HILITE
  COLOR 255 0 0
END

#
# Start of reference map
#
### BEGIN REFMAP REGION
#REFERENCE
#  IMAGE "[% MAPSERVER_DIR %]/graphics/reference.[% IMAGE_SUFFIX %]"
#  EXTENT -80800 -95855 107255 92200
#  SIZE 200 200
#  STATUS ON
#  COLOR [% REFMAPCOLOR %]
#  OUTLINECOLOR [% REFMAPOUTLINE %]
#  MINBOXSIZE 5
#END
### END REFMAP REGION

### BEGIN REFMAP CITY
#REFERENCE
#  IMAGE "[% MAPSERVER_DIR %]/graphics/reference-b.[% IMAGE_SUFFIX %]"
#  EXTENT -15700 -14985 37034 37749
#  SIZE 200 200
#  STATUS ON
#  COLOR [% REFMAPCOLOR %]
#  OUTLINECOLOR [% REFMAPOUTLINE %]
#  MINBOXSIZE 5
#END
### END REFMAP CITY

### BEGIN REFMAP INNERCITY
#REFERENCE
#  IMAGE "[% MAPSERVER_DIR %]/graphics/reference-inner-b.[% IMAGE_SUFFIX %]"
#  EXTENT 1887 4581 15337 18031
#  SIZE 200 200
#  STATUS ON
#  COLOR [% REFMAPCOLOR %]
#  OUTLINECOLOR [% REFMAPOUTLINE %]
#  MINBOXSIZE 5
#END
### END REFMAP CITY

### BEGIN REFMAP WIDEREGION
#REFERENCE
#  IMAGE "[% MAPSERVER_DIR %]/graphics/reference-wide.[% IMAGE_SUFFIX %]"
#  EXTENT -251416 -148630 137301 240086
#  SIZE 200 200
#  STATUS ON
#  COLOR [% REFMAPCOLOR %]
#  OUTLINECOLOR [% REFMAPOUTLINE %]
#  MINBOXSIZE 5
#END
### END REFMAP WIDEREGION

### BEGIN REFMAP POTSDAM
#REFERENCE
#  IMAGE "[% MAPSERVER_DIR %]/graphics/reference-p.[% IMAGE_SUFFIX %]"
#  EXTENT -17562 -6287 -7200 4074
#  SIZE 200 200
#  STATUS ON
#  COLOR [% REFMAPCOLOR %]
#  OUTLINECOLOR [% REFMAPOUTLINE %]
#  MINBOXSIZE 5
#END
### END REFMAP POTSDAM

#
# Start of legend
#
LEGEND
  KEYSIZE 18 12
  LABEL
    TYPE truetype
    FONT "lucida"
    SIZE 10
    COLOR 0 0 0
  END
  IMAGECOLOR 220 220 220
  STATUS ON
END

#
# Start of scalebar
#
SCALEBAR
  IMAGECOLOR 255 255 255
  LABEL
[% IF SMALL_SCREEN -%]
    SIZE tiny
[% ELSE -%]
    TYPE truetype
    FONT "lucida"
    SIZE 8
[% END -%]
    COLOR 255 255 255
  END
  STYLE 1
[% IF SMALL_SCREEN -%]
  SIZE 80 2
[% ELSE -%]
  SIZE 120 2
[% END -%]
  COLOR 255 255 255
  UNITS KILOMETERS
  INTERVALS 1
  TRANSPARENT TRUE
  STATUS TRUE
END

#
# Start of symbol definitions
#
SYMBOL
  NAME 'circle'
  TYPE ELLIPSE
  POINTS 1 1 END
  FILLED TRUE
END

[%# mapserver 5 compat -%]
[% IF MAPSERVER_VERSION < 6 -%]
SYMBOL
  NAME 'circle_12'
  TYPE ELLIPSE
  POINTS 1 1 END
  FILLED TRUE
  STYLE 1 12 END
END

SYMBOL
  NAME 'circle_25'
  TYPE ELLIPSE
  POINTS 1 1 END
  FILLED TRUE
  STYLE 1 25 END
END

SYMBOL
  NAME 'circle_25_transposed'
  TYPE ELLIPSE
  POINTS 1 1 END
  FILLED TRUE
  STYLE 0 12 1 13 0 END
END
[% END -%]

SYMBOL
  NAME 'ring'
  TYPE ELLIPSE
  POINTS 5 5 END
  FILLED FALSE
END

SYMBOL
  NAME 'square'
  TYPE VECTOR
  POINTS 0 0 0 4 4 4 4 0 0 0 END
  FILLED TRUE
END

[% IF SMALL_SCREEN -%]
SYMBOL
  NAME 'width'
  TYPE VECTOR
  POINTS 0 0 0 1 1 1 1 0 0 0 END
  FILLED TRUE
END
[% END -%]

SYMBOL
  NAME raute
  TYPE VECTOR
  POINTS 0 2 2 0 4 2 2 4 0 2 END
  FILLED TRUE
[% IF MAPSERVER_VERSION < 6 -%]
  STYLE 4 4 END
[% END -%]
END

[% IF ADVANCED_MOUNT_SYMBOLS -%]
SYMBOL
  NAME mountarrow1
  TYPE truetype
  FONT "lucida"
  TYPE truetype
  CHARACTER ">"
END

SYMBOL
  NAME mountarrow2
  TYPE truetype
  FONT "lucida"
  TYPE truetype
  CHARACTER "»"
END
[% END -%]

SYMBOL
  NAME 'strnrbox'
  TYPE VECTOR
  POINTS 0 0 0 40 80 40 80 0 0 0 END
  FILLED TRUE
END

SYMBOL
  NAME 'cemetery_jewish'
  TYPE PIXMAP
  IMAGE "[% IMAGE_DIR %]/cemetery_jewish_bg.[% IMAGE_SUFFIX %]"
END

SYMBOL
  NAME 'cemetery_muslim'
  TYPE PIXMAP
  IMAGE "[% IMAGE_DIR %]/cemetery_muslim_bg.[% IMAGE_SUFFIX %]"
END

SYMBOL
  NAME 'cemetery'
  TYPE PIXMAP
  IMAGE "[% IMAGE_DIR %]/cemetery_bg.[% IMAGE_SUFFIX %]"
END

SYMBOL
  NAME 'startflag'
  TYPE PIXMAP
  IMAGE "[% IMAGE_DIR %]/flag2_bl_centered.[% IMAGE_SUFFIX %]"
END

SYMBOL
  NAME 'goalflag'
  TYPE PIXMAP
  IMAGE "[% IMAGE_DIR %]/flag_ziel_centered.[% IMAGE_SUFFIX %]"
END

SYMBOL
  NAME 'blocked'
  TYPE VECTOR
  POINTS 0 1 1 0 4 3 7 0 8 1 5 4 8 7 7 8 4 5 1 8 0 7 3 4 0 1 END # cross
  FILLED TRUE
END

[% IF MAPSERVER_VERSION < 6 -%]
SYMBOL
  NAME 'blocked_32'
  TYPE VECTOR
  POINTS 0 1 1 0 4 3 7 0 8 1 5 4 8 7 7 8 4 5 1 8 0 7 3 4 0 1 END # cross
  FILLED TRUE
  STYLE 1 32 END
END

SYMBOL
  NAME 'blocked_40'
  TYPE VECTOR
  POINTS 0 1 1 0 4 3 7 0 8 1 5 4 8 7 7 8 4 5 1 8 0 7 3 4 0 1 END # cross
  FILLED TRUE
  STYLE 1 40 END
END
[% END -%]

SYMBOL
  NAME 'oneway_arrow'
  TYPE VECTOR
  # leftwards arrow
  POINTS 7 2 3 2 3 0 0 3 3 6 3 4 7 4 7 2 END
  FILLED TRUE
END

[% IF MAPSERVER_VERSION < 6 -%]
SYMBOL
  NAME 'oneway_arrow_10'
  TYPE TRUETYPE
  FONT 'lucida'
  FILLED true
  GAP -10
  ANTIALIAS true
  CHARACTER "[% LEFTARROW %]"
END

SYMBOL
  NAME 'oneway_arrow_20'
  TYPE TRUETYPE
  FONT 'lucida'
  FILLED true
  GAP -20
  ANTIALIAS true
  CHARACTER "[% LEFTARROW %]"
END

SYMBOL
  NAME 'dashed1'
[% IF MAPSERVER_DRIVER == "AGG" -%]
  TYPE SIMPLE
  PATTERN 2 4 END
[% ELSE -%]
  TYPE VECTOR
  POINTS 0 2 2 0 4 2 2 4 0 2 END
  FILLED true
  STYLE 1 8 END
[% END -%]
END

SYMBOL
  NAME 'point'
  TYPE ELLIPSE
  POINTS
    1 1
  END
  FILLED TRUE
END

SYMBOL
  NAME 'rectangle-train'
  TYPE VECTOR
  POINTS
    0 0
    0 0.6
    1 0.6
    1 0
    0 0
  END
  FILLED TRUE
  STYLE
    8 12 8 12
  END
END

[% IF MAPSERVER_DRIVER == "AGG" -%]
SYMBOL
  NAME 'train-dashed'
  TYPE SIMPLE
  PATTERN 8 12 END
END
[% END -%]

SYMBOL
  NAME 'dotted12'
  TYPE ELLIPSE
[% IF MAPSERVER_DRIVER == "AGG" -%]
  POINTS 12 12 END
  FILLED TRUE
  GAP 12
[% ELSE -%]
  POINTS 1 1 END
  FILLED TRUE
  STYLE 1 12 END
[% END -%]
END

[% END -%]

#
# Start of layer definitions
#
LAYER
## XXX what's the intention of this layer? provide information in detail view?
  NAME Kommentare
  TYPE QUERY
  STATUS DEFAULT
  DATA comments_without

  CLASS
  END

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  METADATA
    WMS_TITLE "Kommentare"
    WMS_ABSTRACT "Kommentare"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER KOMMENTARE
### END AFTER KOMMENTARE

LAYER
  NAME "Flächen"
  TYPE POLYGON
  STATUS [% ON_FLAECHEN %]
  GROUP flaechen
  DATA flaechen

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

  CLASS
    EXPRESSION "F:Forest"
    NAME "Wald"
    STYLE
      COLOR 102 180 123
    END
  END
  CLASS
    EXPRESSION "F:Orchard"
    NAME "Kleingärten"
    STYLE
      COLOR 232 248 200
    END
  END
  CLASS
    EXPRESSION /^F:(P|Green)$/
    NAME "Park, Grünanlagen"
    STYLE
      COLOR 118 196 139
    END
  END
  CLASS
    EXPRESSION "F:Sport"
    NAME "Sportanlagen"
    STYLE
      COLOR 200 216 152
    END
  END
  CLASS
    EXPRESSION "F:Cemetery|religion:jewish"
    NAME "Jüdischer Friedhof"
    STYLE
      COLOR [% COLOR_MIDDLE_GREEN %]
      SYMBOL "cemetery_jewish"
    END
  END
  CLASS
    EXPRESSION "F:Cemetery|religion:muslim"
    NAME "Muslimischer Friedhof"
    STYLE
      COLOR [% COLOR_MIDDLE_GREEN %]
      SYMBOL "cemetery_muslim"
    END
  END
  CLASS
    EXPRESSION "F:Cemetery"
    NAME "Friedhof"
    STYLE
      COLOR [% COLOR_MIDDLE_GREEN %]
      SYMBOL "cemetery"
    END
  END
  CLASS
    EXPRESSION "F:Ae" 
    NAME "Flughafen"
    STYLE
      COLOR [% COLOR_WHITE %]
    END
  END
  CLASS
    EXPRESSION "F:ex-Ae"
    NAME "ehemaliger Flughafen"
    STYLE
      COLOR [% COLOR_WHITE %]
    END
  END
  CLASS
    EXPRESSION "F:Industrial"
    NAME "Industriegebiete"
    STYLE
      COLOR [% COLOR_ROSE %]
    END
  END
  CLASS
    EXPRESSION "F:#ffffff"
    STYLE
      COLOR [% COLOR_WHITE %]
    END
  END
  CLASS
    EXPRESSION "F:#000000"
    STYLE
      COLOR [% COLOR_BLACK %]
    END
  END
  CLASS
    EXPRESSION "F:#ff0000"
    STYLE
      COLOR [% COLOR_RED %]
    END
  END
  CLASS
    EXPRESSION "F:#00ff00"
    STYLE
      COLOR [% COLOR_GREEN %]
    END
  END
  CLASS
    EXPRESSION "F:#0000ff"
    STYLE
      COLOR [% COLOR_BLUE %]
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Flächen"
    WMS_ABSTRACT "Sonstige Flächen (Parks, Wälder, Flughäfen)"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER FLAECHEN
### END AFTER FLAECHEN

LAYER
  NAME "Gewässer"
  GROUP gewaesser
  TYPE LINE
  STATUS [% ON_GEWAESSER %]
  DATA wasserstrassen
  
  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[% BLOCK CLASS_W_ANY -%]
  CLASS
    EXPRESSION "[% expr %]"
    LABEL
      MINFEATURESIZE [% IF expr == "W" || expr == "W0" %]200[% ELSE %]40[% END %]
      MINDISTANCE 150
      POSITION auto
      TYPE truetype
      FONT "lucida"
[% IF SMALL_SCREEN -%]
[%   IF expr == "W2" -%]
      MINSIZE 7
[%   ELSE -%]
      MINSIZE 6
[%   END -%]
[% ELSE -%]
      MINSIZE 8
[% END -%]
      COLOR 0 0 255
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      SYMBOL "circle"
      COLOR 180 180 255
      SIZE [% size %]
      [% IF maxscale %]MAXSCALEDENOM [% maxscale %][% END %]
      [% IF minscale %]MINSCALEDENOM [% minscale %][% END %]
    END
  END
[% END -%]
[% PROCESS CLASS_W_ANY expr="W" size=1 minscale=20000 maxscale=400000 -%]
[% PROCESS CLASS_W_ANY expr="W" size=2 minscale=10000 maxscale=20000 -%]
[% PROCESS CLASS_W_ANY expr="W" size=4 minscale=undef maxscale=10000 -%]

[% PROCESS CLASS_W_ANY expr="W0" size=1 minscale=10000 maxscale=80000 -%]
[% PROCESS CLASS_W_ANY expr="W0" size=2 minscale=5000  maxscale=10000 -%]
[% PROCESS CLASS_W_ANY expr="W0" size=3 minscale=undef maxscale=5000 -%]

[% PROCESS CLASS_W_ANY expr="W1" size=2 minscale=200000 maxscale=1000000 -%]
[% PROCESS CLASS_W_ANY expr="W1" size=3 minscale=20000  maxscale=200000 -%]
[% PROCESS CLASS_W_ANY expr="W1" size=5 minscale=10000  maxscale=20000 -%]
[% PROCESS CLASS_W_ANY expr="W1" size=7 minscale=undef  maxscale=10000 -%]

[% PROCESS CLASS_W_ANY expr="W2" size=2  minscale=1000000 maxscale=undef   -%]
[% PROCESS CLASS_W_ANY expr="W2" size=6  minscale=20000   maxscale=1000000 -%]
[% PROCESS CLASS_W_ANY expr="W2" size=9  minscale=10000   maxscale=20000   -%]
[% PROCESS CLASS_W_ANY expr="W2" size=12 minscale=undef   maxscale=10000   -%]

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Gewässer"
    WMS_ABSTRACT "Gewässer in Liniendarstellung (Flüsse und Kanäle)"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER GEWAESSER
### END AFTER GEWAESSER

LAYER
  NAME "Gewässer (Polygone)"
  GROUP gewaesser
  TYPE POLYGON
  STATUS [% ON_GEWAESSER %]
  DATA wasserstrassen_polygon

  TOLERANCE 3
  #DUMP TRUE # allow GML export

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

  CLASS
    EXPRESSION /^W/ 
    NAME "Gewässer"
    LABEL
      MINDISTANCE 150
      POSITION auto
      TYPE truetype
      FONT "lucida"
[% IF SMALL_SCREEN -%]
      MINSIZE 6
[% ELSE -%]
      MINSIZE 8
[% END -%]
      COLOR 0 0 255
      PARTIALS FALSE
    END
    STYLE
      COLOR 180 180 255
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Gewässer (Polygone)"
    WMS_ABSTRACT "Gewässer in Polygondarstellung (Seen)"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER GEWAESSER_POLYGONE
### END AFTER GEWAESSER_POLYGONE

LAYER
  NAME "Inseln"
  GROUP gewaesser
  TYPE POLYGON
  STATUS [% ON_GEWAESSER %]
  DATA wasserstrassen_polygon

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

  CLASS
    EXPRESSION "I" 
    STYLE
      COLOR 225 225 225
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  METADATA
    WMS_TITLE "Inseln"
    WMS_ABSTRACT "Inseln"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER INSELN
### END AFTER INSELN

LAYER
  NAME "Flächen (above)"
  TYPE POLYGON
  STATUS [% ON_FLAECHEN %]
  GROUP flaechen
  DATA flaechen

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

  CLASS
    EXPRESSION /^F:.*above$/
    STYLE
      COLOR 0 225 0
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Flächen"
    WMS_ABSTRACT "Sonstige Flächen (Parks, Wälder, Flughäfen)"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER FLAECHEN_ABOVE
### END AFTER FLAECHEN_ABOVE

LAYER
  NAME "Fähren"
  TYPE LINE
  STATUS [% ON_FAEHREN %]
  GROUP faehren
  DATA faehren

  LABELITEM 'NAME'

[% BLOCK CLASS_FAEHREN -%]  
  CLASS
    STYLE
      COLOR [% COLOR_WHITE %]
      SYMBOL 'raute'
      SIZE [% size %]
    END
    [% IF maxscale %]MAXSCALEDENOM [% maxscale %][% END %]
    [% IF minscale %]MINSCALEDENOM [% minscale %][% END %]
  END
[% END -%]
[% PROCESS CLASS_FAEHREN size=4 minscale=20000 maxscale=undef -%]
[% PROCESS CLASS_FAEHREN size=5 minscale=10000 maxscale=20000 -%]
[% PROCESS CLASS_FAEHREN size=6 minscale=undef maxscale=10000 -%]

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  METADATA
    WMS_TITLE "Fähren"
    WMS_ABSTRACT "Fähren"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER FAEHREN
### END AFTER FAEHREN

[% IF ENABLE_ANNOTATION_LAYERS -%]
LAYER
  NAME "Fähren (Annotations)"
  GROUP faehren
  STATUS [% ON_FAEHREN %]
  DATA faehren
  TYPE ANNOTATION

  LABELITEM 'STRNR' # dummy ... should be invisible i.e. one space
[% BLOCK CLASS_FERRY -%]
  CLASS
[% IF legend -%]
    NAME "Fähren"
[% END -%]
    STYLE
      COLOR 0 255 0
      SYMBOL '[% IMAGE_DIR %]/ferry[% imgsuffix %].[% IMAGE_SUFFIX %]'
    END
# With Mapserver 5.6.5 and AGG driver the label is not empty, but one pixel is
# drawn. This was not the case with 5.0.3 and GD driver. So don't use a black
# label anymore, but a blue one which matches the ferry icon as closely as
# possible.
    LABEL
      MINFEATURESIZE 10
      MINDISTANCE 150
      POSITION CC
      SIZE TINY
      COLOR 0 128 192
    END
    [% IF maxscale %]MAXSCALEDENOM [% maxscale %][% END %]
    [% IF minscale %]MINSCALEDENOM [% minscale %][% END %]
  END
[% END -%]
[% PROCESS CLASS_FERRY imgsuffix="_klein" minscale=75000 maxscale=150000 legend=0 -%]
[% PROCESS CLASS_FERRY imgsuffix="" minscale=undef maxscale=75000 legend=1 -%]
END
[% END -%]

### BEGIN AFTER FAEHREN_ANNOTATIONS
### END AFTER FAEHREN_ANNOTATIONS

[% BLOCK LAYERFRAG_BORDERS -%]
  GROUP grenzen
  TYPE LINE
  STATUS [% ON_GRENZEN %]
  CLASSITEM 'CAT'
  CLASS
    EXPRESSION /./
[%# Specify only once, to avoid duplication in legend -%]
[% IF with_name -%]
    NAME "Grenze"
[% END -%]
    STYLE
      COLOR 250 0 100
      PATTERN 5 4 1 4 END
[% IF SMALL_SCREEN -%]
      WIDTH 1
[% ELSE -%]
      WIDTH 2
[% END -%]
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
[% END -%]

LAYER
  NAME "Grenzen von Berlin"
  DATA berlin
[% PROCESS LAYERFRAG_BORDERS with_name=1 -%]
  METADATA
    WMS_TITLE "Grenzen von Berlin"
    WMS_ABSTRACT "Grenzen von Berlin"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER GRENZEN_BERLIN
### END AFTER GRENZEN_BERLIN

LAYER
  NAME "Grenzen von Potsdam"
  DATA potsdam
[% PROCESS LAYERFRAG_BORDERS with_name=0 -%]
  METADATA
    WMS_TITLE "Grenzen von Potsdam"
    WMS_ABSTRACT "Grenzen von Potsdam"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER GRENZEN_POTSDAM
### END AFTER GRENZEN_POTSDAM

LAYER
  NAME sehenswuerdigkeit_polygon
  TYPE POLYGON
  STATUS [% ON_SEHENSWUERDIGKEIT %]
  GROUP sehenswuerdigkeit
  DATA sehenswuerdigkeit_polygon
 
  LABELITEM 'NAME'
  CLASSITEM 'CAT'

  CLASS
    EXPRESSION /./
    STYLE
      COLOR 150 150 150
    END
  END

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Sehenswürdigkeiten"
    WMS_ABSTRACT "Sehenswürdigkeiten"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER SEHENSWUERDIGKEIT_POLYGON
### END AFTER SEHENSWUERDIGKEIT_POLYGON

[%
   SET SIZES_N = [
	{size=>1,  minscale=>100000, maxscale=>1000000, legend=>0, outline=>0, lblsize=>8 },
	{size=>2,  minscale=>40000,  maxscale=>100000,  legend=>0, outline=>0, lblsize=>8 },
	{size=>3,  minscale=>20000,  maxscale=>40000,   legend=>0, outline=>0, lblsize=>8 },
	{size=>4,  minscale=>10000,  maxscale=>20000,   legend=>0, outline=>1, lblsize=>8 },
	{size=>5,  minscale=>8000,   maxscale=>10000,   legend=>1, outline=>1, lblsize=>8 },
	{size=>6,  minscale=>6000,   maxscale=>8000,    legend=>0, outline=>1, lblsize=>8 },
	{size=>8,  minscale=>4000,   maxscale=>6000,    legend=>0, outline=>1, lblsize=>9 },
	{size=>10, minscale=>2000,   maxscale=>4000,    legend=>0, outline=>1, lblsize=>9 },
	{size=>12, minscale=>1000,   maxscale=>2000,    legend=>0, outline=>1, lblsize=>10},
	{size=>15, minscale=>undef,  maxscale=>1000,    legend=>0, outline=>1, lblsize=>10},
   ];
   SET SIZES_H = [
	{size=>2   minscale=>500000, maxscale=>1000000, legend=>0, outline=>0, lblsize=>8 },
	{size=>3,  minscale=>200000, maxscale=>500000,  legend=>0, outline=>0, lblsize=>8 },
	{size=>4,  minscale=>20000,  maxscale=>200000,  legend=>0, outline=>0, lblsize=>8 },
	{size=>5,  minscale=>10000,  maxscale=>20000,   legend=>0, outline=>1, lblsize=>8 },
	{size=>6,  minscale=>8000,   maxscale=>10000,   legend=>1, outline=>1, lblsize=>8 },
	{size=>8,  minscale=>6000,   maxscale=>8000,    legend=>0, outline=>1, lblsize=>9 },
	{size=>10, minscale=>4000,   maxscale=>6000,    legend=>0, outline=>1, lblsize=>10},
	{size=>13, minscale=>2000,   maxscale=>4000,    legend=>0, outline=>1, lblsize=>11},
	{size=>16, minscale=>1000,   maxscale=>2000,    legend=>0, outline=>1, lblsize=>12},
	{size=>20, minscale=>undef,  maxscale=>1000,    legend=>0, outline=>1, lblsize=>13},
   ];
   SET SIZES_HH = [
	{size=>2   minscale=>500000, maxscale=>1000000, legend=>0, outline=>0, lblsize=>8 },
	{size=>3,  minscale=>200000, maxscale=>500000,  legend=>0, outline=>0, lblsize=>8 },
	{size=>4,  minscale=>20000,  maxscale=>200000,  legend=>0, outline=>0, lblsize=>8 },
	{size=>5,  minscale=>10000,  maxscale=>20000,   legend=>0, outline=>1, lblsize=>8 },
	{size=>6,  minscale=>8000,   maxscale=>10000,   legend=>1, outline=>1, lblsize=>9 },
	{size=>8,  minscale=>6000,   maxscale=>8000,    legend=>0, outline=>1, lblsize=>10},
	{size=>10, minscale=>4000,   maxscale=>6000,    legend=>0, outline=>1, lblsize=>11},
	{size=>13, minscale=>2000,   maxscale=>4000,    legend=>0, outline=>1, lblsize=>12},
	{size=>16, minscale=>1000,   maxscale=>2000,    legend=>0, outline=>1, lblsize=>13},
	{size=>20, minscale=>undef,  maxscale=>1000,    legend=>0, outline=>1, lblsize=>14},
   ];
   SET SIZES_B = [
	{size=>2,  minscale=>1000000,maxscale=>undef,   legend=>0, outline=>0, lblsize=>8 },
	{size=>3,  minscale=>500000, maxscale=>1000000, legend=>0, outline=>1, lblsize=>8 },
	{size=>4,  minscale=>20000,  maxscale=>500000,  legend=>0, outline=>1, lblsize=>8 },
	{size=>5,  minscale=>10000,  maxscale=>20000,   legend=>0, outline=>1, lblsize=>8 },
	{size=>6,  minscale=>8000,   maxscale=>10000,   legend=>1, outline=>1, lblsize=>9 },
	{size=>8,  minscale=>6000,   maxscale=>8000,    legend=>0, outline=>1, lblsize=>10},
	{size=>10, minscale=>4000,   maxscale=>6000,    legend=>0, outline=>1, lblsize=>11},
	{size=>13, minscale=>2000,   maxscale=>4000,    legend=>0, outline=>1, lblsize=>12},
	{size=>16, minscale=>1000,   maxscale=>2000,    legend=>0, outline=>1, lblsize=>13},
	{size=>20, minscale=>undef,  maxscale=>1000,    legend=>0, outline=>1, lblsize=>14},
   ];

   IF SMALL_SCREEN;
       FOR s IN [SIZES_N, SIZES_H, SIZES_HH, SIZES_B];
           FOR i IN s;
               SET i.lblsize = i.lblsize - 3;
	       IF i.size >= 4;
	           SET i.size = i.size - 3;
	       ELSE;
	       	   SET i.size = 1;
	       END;
           END;
       END;
   END;
-%]

LAYER
  NAME "Autobahnen"
  TYPE LINE
  STATUS [% ON_STRASSEN_BAB %]
  DATA strassen_bab
  GROUP strassen_bab

  #DUMP TRUE # allow GML export

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[% BLOCK CLASS_BAB -%]
  CLASS
    EXPRESSION /^BAB/
[% IF p.legend -%]
    NAME "Autobahn/Kfz-Straße"
[% END -%]
    STYLE
      COLOR 220 20 0
      WIDTH [% p.size + 4 %]
    END
    STYLE
      COLOR 255 205 114
      WIDTH [% (p.size + 4) div 2 %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% FOR i = SIZES_B; # reuse B for BAB
      PROCESS CLASS_BAB p=i;
   END
-%]

  CLASS # should not happen
    EXPRESSION /./ 
    STYLE
      COLOR 200 200 200
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Autobahnen"
    WMS_ABSTRACT "Autobahnen und Kfz-Straßen"
    WMS_SRS "EPSG:4326"
  END
END

LAYER
  NAME "Straßen (Outline)"
  TYPE LINE
  STATUS [% ON_STRASSEN %]
  DATA strassen
  GROUP strassen
  
  #DUMP FALSE

  CLASSITEM 'CAT'
[% BLOCK CLASS_N_OUTL -%]
[% IF p.outline -%]
  CLASS
    EXPRESSION 'NN'
    STYLE
      COLOR 210 210 210
      WIDTH [% p.size + 2 %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
  CLASS
    EXPRESSION 'N'
    STYLE
      COLOR 210 210 210
      WIDTH [% p.size + 2 %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% END -%]
[% FOR i = SIZES_N;
      PROCESS CLASS_N_OUTL p=i;
   END
-%]

[% BLOCK CLASS_H_OUTL -%]
[% IF p.outline -%]
  CLASS
    EXPRESSION 'H'
    STYLE
      COLOR 210 210 210
      WIDTH [% p.size + 2 %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% END -%]
[% FOR i = SIZES_H;
      PROCESS CLASS_H_OUTL p=i;
   END
-%]

[% BLOCK CLASS_HH_OUTL -%]
[% IF p.outline -%]
  # sligtly darker outline
  CLASS
    EXPRESSION 'HH'
    STYLE
      COLOR 180 180 180
      WIDTH [% p.size + 2 %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% END -%]
[% FOR i = SIZES_HH;
      PROCESS CLASS_HH_OUTL p=i;
   END
-%]

[% BLOCK CLASS_B_OUTL -%]
[% IF p.outline -%]
  CLASS
    EXPRESSION 'B'
    STYLE
      COLOR 180 180 180
      WIDTH [% p.size + 2 %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% END -%]
[% FOR i = SIZES_B;
      PROCESS CLASS_B_OUTL p=i;
   END
-%]

  METADATA
    WMS_TITLE "Straßen (Outline)"
    WMS_ABSTRACT "Stadt- und Landstraßen"
    WMS_SRS "EPSG:4326"
  END
END

[% BLOCK LAYER_RADWEGE -%]
LAYER
  NAME Radwege
  GROUP radwege
  TYPE LINE
  STATUS [% ON_RADWEGE %]
  DATA [% data %]

  [% IF maxscale %]MAXSCALEDENOM [% maxscale %][% END %]
  [% IF minscale %]MINSCALEDENOM [% minscale %][% END %]
  TOLERANCE 3

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  CLASSITEM 'CAT'
  CLASS
    EXPRESSION /^RW[1234789\?]?$/
    NAME "Radweg oder -streifen"
    STYLE
      COLOR 100 100 200
      WIDTH [% width %]
    END
  END
  CLASS
    EXPRESSION "RW5"
    NAME "Busspur"
    STYLE
      COLOR 128 128 255
[% IF MAPSERVER_VERSION < 6 -%]
      SYMBOL 'dashed1'
      SIZE [% width %]
[% ELSE -%]
      WIDTH [% width %]
      LINECAP BUTT
      PATTERN 3 6 END
[% END -%]
    END
  END
  METADATA
    WMS_TITLE "Radwege"
    WMS_ABSTRACT "Radwege, verkehrsberuhigte Bereiche und Busspuren"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]

[% IF SMALL_SCREEN; SET RADWEGE_WIDTH_QUOTIENT = 2; ELSE; SET RADWEGE_WIDTH_QUOTIENT = 1; END -%]
[% PROCESS LAYER_RADWEGE data="radwege20" minscale=5000  maxscale=undef width=4 / RADWEGE_WIDTH_QUOTIENT %]
[% PROCESS LAYER_RADWEGE data="radwege10" minscale=2000  maxscale=5000  width=6 / RADWEGE_WIDTH_QUOTIENT %]
[% PROCESS LAYER_RADWEGE data="radwege5"  minscale=undef maxscale=2000  width=8 / RADWEGE_WIDTH_QUOTIENT %]

### BEGIN AFTER RADWEGE
### END AFTER RADWEGE

LAYER
  NAME "Straßen"
  TYPE LINE
  STATUS [% ON_STRASSEN %]
  DATA strassen
  GROUP strassen
  
  #DUMP TRUE # allow GML export

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[%# This is a workaround for a strange bug on radzeit.de.
  # Unless the first entry is disabled, nothing will get displayed
-%]
[% xxx_is_first = 1 -%]
[% BLOCK CLASS_N -%]
[% IF !xxx_is_first -%]
  CLASS
    EXPRESSION 'NN'
[% IF p.legend -%]
    NAME "Nebenstraße, für Kfz gesperrt"
[% END -%]
    LABEL
      MINFEATURESIZE AUTO
      MINDISTANCE 50
      POSITION auto
      TYPE truetype
      FONT "street"
      MINSIZE [% p.lblsize %]
      COLOR 0 0 0
      OUTLINECOLOR 225 225 225
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      COLOR 200 255 200
      WIDTH [% p.size %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% ELSE -%]
[%  xxx_is_first = 0 -%]
[% END -%]
  CLASS
    EXPRESSION 'N'
[% IF p.legend -%]
    NAME "Nebenstraße"
[% END -%]
    LABEL
      MINFEATURESIZE AUTO
      MINDISTANCE 50
      POSITION auto
      TYPE truetype
      FONT "street"
      MINSIZE [% p.lblsize %]
      COLOR 0 0 0
      OUTLINECOLOR 225 225 225
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      COLOR [% COLOR_WHITE %]
      WIDTH [% p.size %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% FOR i = SIZES_N;
      PROCESS CLASS_N p=i;
   END
-%]

[% BLOCK CLASS_NH -%]
  CLASS
    EXPRESSION 'NH'
[% IF p.legend -%]
    NAME "wichtige Nebenstraße"
[% END -%]
    LABEL
      MINFEATURESIZE AUTO
      MINDISTANCE 50
      POSITION auto
      TYPE truetype
      FONT "street"
      MINSIZE [% p.lblsize %]
      COLOR 0 0 0
      OUTLINECOLOR 225 225 225
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      COLOR [% COLOR_PALE_YELLOW %]
      WIDTH [% p.size %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% FOR i = SIZES_N;
      PROCESS CLASS_NH p=i;
   END
-%]

[% BLOCK CLASS_H -%]
  CLASS
    EXPRESSION 'H'
[% IF p.legend -%]
    NAME "Hauptstraße"
[% END -%]
    LABEL
      MINFEATURESIZE AUTO
      MINDISTANCE 50
      POSITION auto
      TYPE truetype
      FONT "street"
      MINSIZE [% p.lblsize %]
      COLOR 0 0 0
      OUTLINECOLOR 225 225 225
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      COLOR [% COLOR_LIGHT_YELLOW %]
      WIDTH [% p.size %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% FOR i = SIZES_H;
      PROCESS CLASS_H p=i;
   END
-%]

[% BLOCK CLASS_HH -%]
  CLASS
    EXPRESSION 'HH'
[% IF p.legend -%]
    NAME "Wichtige Hauptstraße"
[% END -%]
    LABEL
      MINFEATURESIZE 40
      MINDISTANCE 50
      POSITION auto
      TYPE truetype
      FONT "street"
      MINSIZE [% p.lblsize %]
      COLOR 0 0 0
      OUTLINECOLOR 225 225 225
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      COLOR 255 255 0
      WIDTH [% p.size %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% FOR i = SIZES_HH;
      PROCESS CLASS_HH p=i;
   END
-%]

[% BLOCK CLASS_B -%]
  CLASS
    EXPRESSION 'B'
[% IF p.legend -%]
    NAME "Bundesstraße"
[% END -%]
    LABEL
      MINFEATURESIZE 40
      MINDISTANCE 50
      POSITION auto
      TYPE truetype
      FONT "street"
      MINSIZE [% p.lblsize %]
      COLOR 0 0 0
      OUTLINECOLOR 225 225 225
      ANGLE AUTO
      PARTIALS FALSE
    END
    STYLE
      COLOR 255 130 130
      WIDTH [% p.size %]
    END
    [% IF p.maxscale %]MAXSCALEDENOM [% p.maxscale %][% END %]
    [% IF p.minscale %]MINSCALEDENOM [% p.minscale %][% END %]
  END
[% END -%]
[% FOR i = SIZES_B;
      PROCESS CLASS_B p=i;
   END
-%]

  CLASS # should not happen
    EXPRESSION /./ 
    STYLE
      COLOR 200 200 200
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Straßen"
    WMS_ABSTRACT "Stadt- und Landstraßen"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER STRASSEN
### END AFTER STRASSEN

[% BLOCK CLASS_STRNR -%]
  CLASS
    EXPRESSION [% expression %]
    STYLE
      COLOR [% color %]
      SYMBOL 'strnrbox'
      SIZE 10
    END
    LABEL
      MINFEATURESIZE 50
      MINDISTANCE 150
      POSITION CC
      TYPE truetype
      FONT "lucida"
      SIZE 6
      COLOR [% textcolor %]
    END
  END
[% END -%]

[% IF ENABLE_ANNOTATION_LAYERS -%]
LAYER
  NAME "Straßen (Annotations)"
  GROUP strassen
  STATUS [% ON_STRASSEN %]
  DATA strassen
  TYPE ANNOTATION

  CLASSITEM 'CAT'
  LABELITEM 'STRNR'

[% PROCESS CLASS_STRNR expression="/^B/" color=COLOR_YELLOW textcolor=COLOR_BLACK -%]
  METADATA
    WMS_TITLE "Straßennummern"
    WMS_ABSTRACT "Straßennummern"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]

[% IF ENABLE_ANNOTATION_LAYERS -%]
LAYER
  NAME "Autobahnen (Annotations)"
  GROUP strassen_bab
  STATUS [% ON_STRASSEN_BAB %]
  DATA strassen_bab
  TYPE ANNOTATION

  CLASSITEM 'FULLNAME'
  LABELITEM 'STRNR'

[% PROCESS CLASS_STRNR expression="/^BAB/" color=COLOR_BLUE   textcolor=COLOR_WHITE -%]
[% PROCESS CLASS_STRNR expression="/^B/"   color=COLOR_YELLOW textcolor=COLOR_BLACK -%]
[% PROCESS CLASS_STRNR expression="/^L/"   color=COLOR_WHITE  textcolor=COLOR_BLACK -%]
  METADATA
    WMS_TITLE "Autobahnnummern"
    WMS_ABSTRACT "Autobahnnummern"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]

[% IF ENABLE_ANNOTATION_LAYERS -%]
LAYER
  NAME "Radrouten (Annotations)"
  GROUP comments_route
  STATUS [% ON_RADROUTEN %]
  DATA comments_route
  TYPE ANNOTATION

  CLASSITEM 'CAT'
  LABELITEM 'STRNR'

[% PROCESS CLASS_STRNR expression="/^.+/" color=COLOR_GREEN  textcolor=COLOR_BLACK -%]
  METADATA
    WMS_TITLE "Radroutennummern"
    WMS_ABSTRACT "Nummerierung von ausgeschilderten Radrouten"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]

### BEGIN AFTER STRASSEN_ANNOTATIONS
### END AFTER STRASSEN_ANNOTATIONS
[% IF INCLUDE_AFTER_STRASSEN_ANNOTATIONS.defined -%]
[%   INCLUDE $INCLUDE_AFTER_STRASSEN_ANNOTATIONS -%]
[% END -%]

LAYER
  NAME "U-Bahn"
  GROUP bahn
  TYPE LINE
  STATUS [% ON_U_BAHN %]
  DATA ubahn
  
  CLASSITEM 'CAT'
  CLASS
    EXPRESSION /^U[ABC]?$/
    STYLE
      COLOR 0 0 128
    END
    MINSCALEDENOM 20000
  END
  CLASS
    EXPRESSION /^U[ABC]?$/
    MAXSCALEDENOM 20000
    STYLE
      COLOR 0 0 128
[% IF SMALL_SCREEN -%]
      WIDTH 1
[% ELSE -%]
      WIDTH 2
[% END -%]
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "U-Bahnlinien"
    WMS_ABSTRACT "U-Bahnlinien"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER UBAHN
### END AFTER UBAHN

[% IF MAPSERVER_VERSION < 6 -%]
LAYER
  NAME "Regionalbahn"
  GROUP bahn
  TYPE LINE
  STATUS [% ON_R_BAHN %]
  DATA rbahn
  
  CLASSITEM 'CAT'
  CLASS
    EXPRESSION /^R[ABC]?$/
    STYLE
      COLOR 0 128 0
    END
    MINSCALEDENOM 20000
  END
  CLASS
    EXPRESSION /^R[ABC]?$/
    MAXSCALEDENOM 20000
[% IF MAPSERVER_DRIVER == "AGG" -%]
    STYLE
      COLOR 0 128 0
[% IF SMALL_SCREEN -%]
      WIDTH 2
[% ELSE -%]
      WIDTH 4
[% END -%]
    END
    STYLE
      COLOR 255 255 255
      SYMBOL 'train-dashed'
[% IF SMALL_SCREEN -%]
      WIDTH 1
[% ELSE -%]
      WIDTH 2
[% END -%]
    END
[% ELSE -%]
    STYLE
      COLOR 0 128 0
      SYMBOL 'point'
[% IF SMALL_SCREEN -%]
      WIDTH 2
[% ELSE -%]
      WIDTH 4
[% END -%]
    END
    STYLE
      COLOR 255 255 255
      SYMBOL 'rectangle-train'
[% IF SMALL_SCREEN -%]
      WIDTH 1
[% ELSE -%]
      WIDTH 2
[% END -%]
    END
[% END -%]
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Regionalbahnlinien"
    WMS_ABSTRACT "Regionalbahnlinien"
    WMS_SRS "EPSG:4326"
  END
END
[% ELSE -%]
LAYER
  NAME "Regionalbahn"
  GROUP bahn
  TYPE LINE
  STATUS [% ON_R_BAHN %]
  DATA rbahn
  
  CLASSITEM 'CAT'
  CLASS
    EXPRESSION /^R[ABC]?$/
    STYLE
      COLOR 0 128 0
    END
    MINSCALEDENOM 20000
  END
  CLASS
    EXPRESSION /^R[ABC]?$/
    MAXSCALEDENOM 20000
    STYLE
      COLOR 0 128 0
[% IF SMALL_SCREEN -%]
      WIDTH 2.0
[% ELSE -%]
      WIDTH 4.0
[% END -%]
    END
    STYLE
      COLOR 255 255 255
[% IF SMALL_SCREEN -%]
      WIDTH 1.0
[% ELSE -%]
      WIDTH 2.0
[% END -%]
      LINECAP BUTT
      PATTERN 8 12 END
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Regionalbahnlinien"
    WMS_ABSTRACT "Regionalbahnlinien"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]

### BEGIN AFTER REGIONALBAHN
### END AFTER REGIONALBAHN

LAYER
  NAME "S-Bahn"
  GROUP bahn
  TYPE LINE
  STATUS [% ON_S_BAHN %]
  DATA sbahn
  
  CLASSITEM 'CAT'
  CLASS
    EXPRESSION /^S[ABC]?$/
    STYLE
      COLOR 0 128 0
    END
    MINSCALEDENOM 20000
  END
  CLASS
    EXPRESSION /^S[ABC]?$/
    MAXSCALEDENOM 20000
    STYLE
      COLOR 0 128 0
[% IF SMALL_SCREEN -%]
      WIDTH 1
[% ELSE -%]
      WIDTH 2
[% END -%]
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "S-Bahnlinien"
    WMS_ABSTRACT "S-Bahnlinien"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER SBAHN
### END AFTER SBAHN

LAYER
  NAME "Radrouten"
  GROUP comments_route
  STATUS [% ON_RADROUTEN %]
  DATA comments_route
  TYPE LINE

  LABELITEM 'STRNR'
  CLASSITEM 'CAT'

  CLASS
    Name "Ausgeschilderte Radroute"
    STYLE
      COLOR [% COLOR_GREEN %]
[% IF SMALL_SCREEN -%]
      SIZE 5
[% ELSE -%]
      SIZE 10
[% END -%]
[% IF MAPSERVER_VERSION < 6 AND MAPSERVER_DRIVER == "AGG" -%]
      SYMBOL 'dotted12'
[% ELSE -%]
      SYMBOL 'circle[% IF MAPSERVER_VERSION < 6 %]_12[% END %]'
[% IF MAPSERVER_VERSION >= 6  -%]
      GAP 12
[% END -%]
[% END -%]
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Radrouten"
    WMS_ABSTRACT "Ausgeschilderte Radrouten"
    WMS_SRS "EPSG:4326"
  END
END

LAYER
  NAME "Straßenqualität"
  TYPE LINE
  STATUS [% ON_QUALITAET %]
  GROUP qualitaet
  DATA qualitaet
  MAXSCALEDENOM 550000

  #DUMP TRUE # allow GML export

  CLASSITEM 'CAT'

[% BLOCK STYLE_QUALITY -%]
    STYLE
      COLOR [% color %]
[% IF MAPSERVER_VERSION < 6 -%]
      SYMBOL "raute"
      SIZE 4
[% ELSE -%]
      WIDTH 4
      LINECAP BUTT
      PATTERN 1.5 3 END
[% END -%]
    END
[% END -%]

  CLASS
    EXPRESSION 'Q0'
    NAME "Sehr gute Fahrbahnqualität"
[% PROCESS STYLE_QUALITY color="0 160 0" -%]
  END
  CLASS
    EXPRESSION 'Q1'
    NAME "Gute Fahrbahnqualität"
[% PROCESS STYLE_QUALITY color="0 255 0" -%]
  END
  CLASS
    EXPRESSION 'Q2'
    NAME "Mäßige Fahrbahnqualität"
[% PROCESS STYLE_QUALITY color="255 200 0" -%]
  END
  CLASS
    EXPRESSION 'Q3'
    NAME "Schlechte Fahrbahnqualität"
[% PROCESS STYLE_QUALITY color="255 0 0" -%]
  END
  CLASS # should not happen
    EXPRESSION /./ 
    STYLE
      COLOR 200 200 200
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Fahrbahnqualität"
    WMS_ABSTRACT "Fahrbahnqualität (Kopfsteinpflaster etc.). Auf diesen Strecken ist der Fahrkomfort beeinträchtigt und es können deshalb nur geringere Geschwindigkeiten gefahren werden."
    WMS_SRS "EPSG:4326"
  END
END

LAYER
  NAME "Sonstige Behinderungen"
  TYPE LINE
  STATUS [% ON_HANDICAP %]
  GROUP handicap
  DATA handicap
  MAXSCALEDENOM 550000

  #DUMP TRUE # allow GML export
  
  CLASSITEM 'CAT'

[% BLOCK STYLE_HANDICAP -%]
    STYLE
      COLOR [% color %]
[% IF MAPSERVER_VERSION < 6 -%]
      SYMBOL "raute"
      SIZE 4
[% ELSE -%]
      WIDTH 4
      LINECAP BUTT
      PATTERN 1 4 END
[% END -%]
    END
[% END -%]

# CLASS
#   EXPRESSION 'q0'
#   NAME "Keine sonstigen Behinderungen"
#[%# PROCESS STYLE_HANDICAP color="0 160 0" -%]
# END
  CLASS
    EXPRESSION 'q1'
#    NAME "auf 25 km/h" # not here, too avoid confusion in legend
[% PROCESS STYLE_HANDICAP color="0 255 0" -%]
  END
  CLASS
    EXPRESSION 'q2'
#    NAME "auf 18 km/h" # not here, too avoid confusion in legend
[% PROCESS STYLE_HANDICAP color="255 200 0" -%]
  END
  CLASS
    EXPRESSION 'q3'
#    NAME "auf 13 km/h" # not here, too avoid confusion in legend
[% PROCESS STYLE_HANDICAP color="255 0 0" -%]
  END
  CLASS
    EXPRESSION 'q4'
    NAME "Schrittgeschwindigkeit"
[% PROCESS STYLE_HANDICAP color="200 0 0" -%]
  END
  CLASS # should not happen
    EXPRESSION /./ 
    STYLE
      COLOR 200 200 200
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Sonstige Behinderungen"
    WMS_ABSTRACT "Sonstige Behinderungen, die den Radfahrer auf niedrigere Geschwindigkeiten zwingen. In der Regel ist der Fahrkomfort auf diesen Strecken nicht beeinträchtigt."
    WMS_SRS "EPSG:4326"
  END
END

LAYER
  NAME "Gesperrte Straßen"
  TYPE LINE
  STATUS [% ON_BLOCKED %]
  DATA gesperrt30
  GROUP blocked

  CLASSITEM 'CAT'
  CLASS
    EXPRESSION '2'
    NAME "für Radfahrer gesperrte Straße"
    STYLE
      COLOR 200 0 0
[% IF SMALL_SCREEN -%]
      SIZE 5
[% ELSE -%]
      SIZE 10
[% END -%]
      SYMBOL 'blocked[% IF MAPSERVER_VERSION < 6 %]_40[% END %]'
[% IF MAPSERVER_VERSION >= 6  -%]
      GAP 40
[% END -%]
    END
    MAXSCALEDENOM 30000
  END
  CLASS
    EXPRESSION '2'
    STYLE
      COLOR 200 0 0
      SIZE 7
      SYMBOL 'blocked[% IF MAPSERVER_VERSION < 6 %]_32[% END %]'
[% IF MAPSERVER_VERSION >= 6  -%]
      GAP 32
[% END -%]
    END
    MINSCALEDENOM 30000
  END
END

LAYER
  NAME "Einbahnstraßen"
  TYPE LINE
  STATUS [% ON_BLOCKED %]
  DATA gesperrt
  GROUP blocked

  CLASSITEM 'CAT'
## Hack 1_left/1_right notwendig, siehe -onewayhack in .../miscsrc/bbd2esri
  CLASS
    EXPRESSION /^1(_(right|left))?$/
    NAME "Einbahnstraße"
    STYLE
      COLOR 0 0 200
[% IF SMALL_SCREEN -%]
      SIZE 5
[% ELSE -%]
      SIZE 10
[% END -%]
      SYMBOL 'oneway_arrow[% IF MAPSERVER_VERSION < 6 %]_20[% END %]'
[% IF MAPSERVER_VERSION >= 6  -%]
      GAP -20
[% END -%]
    END
    MAXSCALEDENOM 30000
  END
  CLASS
    EXPRESSION /^1(_(right|left))?$/
    STYLE
      COLOR 0 0 200
[% IF SMALL_SCREEN -%]
      SIZE 3
[% ELSE -%]
      SIZE 7
[% END -%]
      SYMBOL 'oneway_arrow[% IF MAPSERVER_VERSION < 6 %]_10[% END %]'
[% IF MAPSERVER_VERSION >= 6  -%]
      GAP -10
[% END -%]
    END
    MINSCALEDENOM 30000
    MAXSCALEDENOM 60000
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Gesperrte Straßen"
    WMS_ABSTRACT "Gesperrte Straßen"
    WMS_SRS "EPSG:4326"
  END
END

LAYER
  NAME "Punktuelle Einschränkungen"
  TYPE POINT
  STATUS [% ON_BLOCKED %]
  DATA gesperrt_point
  GROUP blocked

[% TRANSPARENCY_ALPHA %] 
  CLASSITEM 'CAT'
  CLASS
    EXPRESSION 'BNP'
    NAME "Drängelgitter, Schranken (bis 1:8000)"
    MAXSCALEDENOM 8000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/legend_narrowpassage.[% IMAGE_SUFFIX %]'
      ANGLE [ANGLE]
    END
  END
  CLASS
    EXPRESSION '0'
    NAME "Tragen erforderlich (bis 1:8000)"
    MAXSCALEDENOM 8000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/legend_carry.[% IMAGE_SUFFIX %]'
      ANGLE [ANGLE]
    END
  END

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Punktuelle Einschränkungen"
    WMS_ABSTRACT "Punktuelle Einschränkungen"
    WMS_SRS "EPSG:4326"
  END
END

# Steigungen
# XXX Suboptimal gezeichnet. Vielleicht mit (mehrfachen) Größer-Zeichen,
# optional mit Prozentangabe, falls es große Steigungen sind?
LAYER
  NAME "Steigungen"
  TYPE LINE
  STATUS [% ON_MOUNT %]
  GROUP mount
  DATA mount

  LABELITEM 'NAME'
  CLASSITEM 'NAME'

  MAXSCALEDENOM 60000
  
[% IF ADVANCED_MOUNT_SYMBOLS -%]
  CLASS
    EXPRESSION /^Steigung [012]\./
    STYLE
      COLOR 0 0 0
      SYMBOL "mountarrow1"
      SIZE 5
      GAP -40
      ANGLE 0
    END
  END
  CLASS
    EXPRESSION /^Steigung [34]\./
    STYLE
      COLOR 0 0 0
      SYMBOL "mountarrow2"
      SIZE 8
      GAP -40
      ANGLE 0
    END
  END
  CLASS
    EXPRESSION /^Steigung ([5-9]\.|\d\d)/
    STYLE
      COLOR 0 0 0
      SYMBOL "mountarrow2"
      SIZE 12
      GAP -40
      ANGLE 0
    END
  END
[% ELSE -%]
  CLASS
    STYLE
      COLOR 255 255 255
      SYMBOL "raute"
      SIZE 4
    END
  END
[% END -%]

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  METADATA
    WMS_TITLE "Steigungen"
    WMS_ABSTRACT "Steigungen"
    WMS_SRS "EPSG:4326"
  END
END

[% IF ENABLE_ANNOTATION_LAYERS -%]
LAYER
  NAME "Steigungen (Annotations)"
  GROUP mount
  MAXSCALEDENOM 75000
  STATUS [% ON_MOUNT %]
  DATA mount
  TYPE ANNOTATION

  LABELITEM 'STRNR' # dummy ... should be invisible i.e. one space

  CLASS
    NAME "mount"
    STYLE
      COLOR 0 255 0
      SYMBOL '[% IMAGE_DIR %]/steigung.[% IMAGE_SUFFIX %]'
    END
    LABEL
      MINFEATURESIZE 10
      MINDISTANCE 150
      POSITION CC
      SIZE TINY
      COLOR 0 0 0
    END
  END
END
[% END -%]

LAYER
  NAME "Fragezeichen"
  GROUP fragezeichen
  TYPE LINE
  STATUS [% ON_FRAGEZEICHEN %]
  DATA fragezeichen
  
  LABELITEM 'CAT'
  CLASSITEM 'CAT'

  CLASS
    NAME "Fragezeichen"
    STYLE
      SYMBOL 'raute'
      SIZE 4
      COLOR 159 0 0
    END
    LABEL
      MINFEATURESIZE 20
      MINDISTANCE 100
      POSITION CC
      TYPE truetype
      FONT "lucida"
      SIZE 11
      COLOR 180 0 0
      OUTLINECOLOR 225 225 225
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Fragezeichen"
    WMS_ABSTRACT "Unsichere Daten"
    WMS_SRS "EPSG:4326"
  END
END

[% BLOCK CLASS_BAHNHOF -%]
  CLASS
    EXPRESSION [% expr %]
    STYLE
[% IF symbol -%]
      COLOR [% symbolcolor %]
      SYMBOL '[% symbol %]'
      SIZE [% symbolsize %]
[% ELSE -%]
      SYMBOL '[% IMAGE_DIR %]/[% imagename %][% imagesize %].[% IMAGE_SUFFIX %]'
[% END -%]
    END
[% IF SMALL_SCREEN; SET SCALE_QUOTIENT = 3; ELSE; SET SCALE_QUOTIENT = 1; END -%]
    [% IF maxscale %]MAXSCALEDENOM [% maxscale / SCALE_QUOTIENT %][% END %]
    [% IF minscale %]MINSCALEDENOM [% minscale / SCALE_QUOTIENT %][% END %]
[% IF do_label -%]
    LABEL
      POSITION auto
      TYPE truetype
      FONT "lucida"
      SIZE 7
      COLOR [% labelcolor %]
      OUTLINECOLOR 225 225 225
    END
[% END -%]
  END
[% END -%]

LAYER
  NAME "U-Bahnhof"
  GROUP bahn
  TYPE POINT
  STATUS [% ON_U_BAHN %]
  DATA ubahnhof
  MAXSCALEDENOM 300000
  TOLERANCE 5

  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[% PROCESS CLASS_BAHNHOF expr="/^U[ABC]?\$/" symbol="square" symbolcolor="0 0 128" symbolsize="4" minscale=150000 maxscale=undef  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^U[ABC]?\$/" symbol=undef imagename="ubahn" imagesize="_mini"     minscale=75000  maxscale=150000 do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^U[ABC]?\$/" symbol=undef imagename="ubahn" imagesize="_klein"    minscale=25000  maxscale=75000  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^U[ABC]?\$/" symbol=undef imagename="ubahn" imagesize=""        minscale=15000  maxscale=25000  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^U[ABC]?\$/" symbol=undef imagename="ubahn" imagesize=""        minscale=undef  maxscale=15000  do_label=1 labelcolor="0 0 128" -%]

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "U-Bahnhöfe"
    WMS_ABSTRACT "U-Bahnhöfe"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER UBAHNHOF
### END AFTER UBAHNHOF

# rbahnhof is below sbahnhof, because no funky sign yet...
LAYER
  NAME rbahnhof
  GROUP bahn
  TYPE POINT
  STATUS [% ON_R_BAHN %]
  DATA rbahnhof
  MAXSCALEDENOM 300000
  TOLERANCE 3
  
  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[% PROCESS CLASS_BAHNHOF expr="/^R[ABC]?\$/" symbol="circle" symbolcolor="0 128 0" symbolsize="6"   minscale=150000 maxscale=undef  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^R[ABC]?\$/" symbol=undef imagename="eisenbahn" imagesize="_mini"   minscale=75000  maxscale=150000 do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^R[ABC]?\$/" symbol=undef imagename="eisenbahn" imagesize="_klein"  minscale=25000  maxscale=75000  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^R[ABC]?\$/" symbol=undef imagename="eisenbahn" imagesize=""        minscale=15000  maxscale=25000  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^R[ABC]?\$/" symbol=undef imagename="eisenbahn" imagesize=""        minscale=undef  maxscale=15000  do_label=1 labelcolor="0 128 0" -%]

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Regionalbahnhöfe"
    WMS_ABSTRACT "Regionalbahnhöfe"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER RBAHNHOF
### END AFTER RBAHNHOF

LAYER
  NAME "S-Bahnhof"
  GROUP bahn
  TYPE POINT
  STATUS [% ON_S_BAHN %]
  DATA sbahnhof
  MAXSCALEDENOM 300000
  TOLERANCE 5
 
  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[% PROCESS CLASS_BAHNHOF expr="/^S[ABC]?\$/" symbol="circle" symbolcolor="0 128 0" symbolsize="6" minscale=150000 maxscale=undef  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^S[ABC]?\$/" symbol=undef imagename="sbahn" imagesize="_mini"     minscale=75000  maxscale=150000 do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^S[ABC]?\$/" symbol=undef imagename="sbahn" imagesize="_klein"    minscale=25000  maxscale=75000  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^S[ABC]?\$/" symbol=undef imagename="sbahn" imagesize=""          minscale=15000  maxscale=25000  do_label=0 -%]
[% PROCESS CLASS_BAHNHOF expr="/^S[ABC]?\$/" symbol=undef imagename="sbahn" imagesize=""          minscale=undef  maxscale=15000  do_label=1 labelcolor="0 128 0" -%]

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "S-Bahnhöfe"
    WMS_ABSTRACT "S-Bahnhöfe"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER SBAHNHOF
### END AFTER SBAHNHOF

LAYER
  NAME Orte
  TYPE POINT
  STATUS [% ON_ORTE %]
  GROUP orte
  DATA orte
  
  LABELITEM 'NAME'
  CLASSITEM 'CAT'

[% BLOCK CLASS_ORT -%]
  CLASS
    EXPRESSION "[% cat %]"
    STYLE
      COLOR 0 0 0
      SYMBOL 'circle'
      SIZE [% size %]
    END
    LABEL
      FORCE [% force %]
      MINFEATURESIZE 40
      MINDISTANCE 150
      POSITION auto
      TYPE truetype
      FONT "lucida"
      SIZE [% lblsize %]
      COLOR 0 0 0
    END
    [% IF maxscale %]MAXSCALEDENOM [% maxscale %][% END %]
    [% IF minscale %]MINSCALEDENOM [% minscale %][% END %]
  END
[% END -%]
[% SET force="false" -%]
[% PROCESS CLASS_ORT cat=0 size=2 lblsize=6 minscale=35000 maxscale=200000 -%]
[% PROCESS CLASS_ORT cat=0 size=4 lblsize=8 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=0 size=6 lblsize=10 minscale=undef maxscale=10000 -%]

[% PROCESS CLASS_ORT cat=1 size=2 lblsize=6 minscale=200000 maxscale=300000 -%]
[% PROCESS CLASS_ORT cat=1 size=4 lblsize=7 minscale=35000 maxscale=200000 -%]
[% PROCESS CLASS_ORT cat=1 size=6 lblsize=9 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=1 size=8 lblsize=11 minscale=undef maxscale=10000 -%]

[% PROCESS CLASS_ORT cat=2 size=4 lblsize=7 minscale=200000 maxscale=400000 -%]
[% PROCESS CLASS_ORT cat=2 size=6 lblsize=8 minscale=35000 maxscale=200000 -%]
[% PROCESS CLASS_ORT cat=2 size=8 lblsize=10 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=2 size=10 lblsize=12 minscale=undef maxscale=10000 -%]

[% PROCESS CLASS_ORT cat=3 size=8 lblsize=9 minscale=35000 maxscale=1000000 -%]
[% PROCESS CLASS_ORT cat=3 size=10 lblsize=11 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=3 size=12 lblsize=13 minscale=undef maxscale=10000 -%]

[% PROCESS CLASS_ORT cat=4 size=10 lblsize=10 minscale=35000 maxscale=1000000 -%]
[% PROCESS CLASS_ORT cat=4 size=12 lblsize=12 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=4 size=14 lblsize=14 minscale=undef maxscale=10000 -%]

[% SET force="true" -%]
[% PROCESS CLASS_ORT cat=5 size=2 lblsize=1 minscale=1000000 maxscale=undef -%]
[% PROCESS CLASS_ORT cat=5 size=12 lblsize=11 minscale=35000 maxscale=1000000 -%]
[% PROCESS CLASS_ORT cat=5 size=14 lblsize=13 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=5 size=16 lblsize=15 minscale=undef maxscale=10000 -%]

[% PROCESS CLASS_ORT cat=6 size=3 lblsize=2 minscale=1000000 maxscale=undef -%]
[% PROCESS CLASS_ORT cat=6 size=15 lblsize=12 minscale=35000 maxscale=1000000 -%]
[% PROCESS CLASS_ORT cat=6 size=17 lblsize=14 minscale=10000 maxscale=35000 -%]
[% PROCESS CLASS_ORT cat=6 size=19 lblsize=16 minscale=undef maxscale=10000 -%]

  CLASS
    EXPRESSION /./
    STYLE
      COLOR 0 0 0
      SYMBOL 'circle'
      SIZE 1
    END
    LABEL
      MINFEATURESIZE 40
      MINDISTANCE 150
      POSITION auto
      TYPE truetype
      FONT "lucida"
      SIZE 6
      COLOR 0 0 0
    END
  END
  METADATA
    WMS_TITLE "Ortschaften"
    WMS_ABSTRACT "Dörfer, Stadtteile und Städte"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER ORTE
### END AFTER ORTE

LAYER
  NAME Obst
  TYPE POINT
  STATUS [% ON_OBST %]
  GROUP obst
  DATA obst
  MAXSCALEDENOM 300000
  
  CLASSITEM 'NAME'
  CLASS
    EXPRESSION "Pflaume"
    STYLE
      SYMBOL '[% IMAGE_DIR %]/pflaume.[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    EXPRESSION "Apfel"
    STYLE
      SYMBOL '[% IMAGE_DIR %]/apfel.[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    EXPRESSION "Kirsche"
    STYLE
      SYMBOL '[% IMAGE_DIR %]/kirsche.[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    EXPRESSION "Birne"
    STYLE
      SYMBOL '[% IMAGE_DIR %]/birne.[% IMAGE_SUFFIX %]'
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Obst"
    WMS_ABSTRACT "Obst"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER OBST
### END AFTER OBST

### XXX hmmm... how to automatically map CAT_IMG to SYMBOL?
#LAYER
#  NAME sehenswuerdigkeit_point
#  TYPE POINT
#  STATUS ON
#  GROUP sehenswuerdigkeit
#  DATA sehenswuerdigkeit_point
#  MAXSCALEDENOM 15000
#  
#  CLASSITEM 'CAT_IMG'
#  CLASS
#    EXPRESSION /brandenburger_tor/
#XXX do not hardcode
#    STYLE
#      SYMBOL '/home/e/eserte/src/bbbike/data/sehenswuerdigkeit_img/brandenburger_tor.[% IMAGE_SUFFIX %]'
#    END
#  END
#  METADATA
#    WMS_TITLE "Sehenswürdigkeiten"
#    WMS_ABSTRACT "Sehenswürdigkeiten"
#    WMS_SRS "EPSG:4326"
#  END
#END

LAYER
  NAME sehenswuerdigkeit_point
  TYPE POINT
  STATUS [% ON_SEHENSWUERDIGKEIT %]
  GROUP sehenswuerdigkeit
  DATA sehenswuerdigkeit_point
  MAXSCALEDENOM 30000
  
[% TRANSPARENCY_ALPHA %] 
  LABELITEM 'NAME'
  CLASSITEM 'CAT'
[% FOR symbol = [
		 ["church", "Kirche"],
		 ["synagogue", "Synagoge"],
		 ["mosque", "Moschee"],
		 ["monument", "Denkmal, Mahnmal"],
		 ["museum", "Museum"],
		 ["theater", "Theater"],
		] -%]
  CLASS
    EXPRESSION 'SW|IMG:[% symbol.0 %]'
    NAME "[% symbol.1 %]"
    STYLE
      SYMBOL '[% IMAGE_DIR %]/[% symbol.0 %].[% IMAGE_SUFFIX %]'
    END
  END
[% END -%]
## XXX Erst aktivieren, wenn sehenswuerdigkeit_polygon auch ..._point für den Mittelpunkt erzeugt
#  CLASS
#    EXPRESSION 'SW|IMG:hospital'
#    NAME "Krankenhaus"
#    STYLE
#      SYMBOL '[% IMAGE_DIR %]/hospital.[% IMAGE_SUFFIX %]'
#    END
#  END
  CLASS
    EXPRESSION /./
    NAME "sonstige Sehenswürdigkeit"
    STYLE
      SYMBOL '[% IMAGE_DIR %]/star.[% IMAGE_SUFFIX %]'
    END
  END
  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Sehenswürdigkeiten"
    WMS_ABSTRACT "Sehenswürdigkeiten"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER SEHENSWUERDIGKEIT_POINT
### END AFTER SEHENSWUERDIGKEIT_POINT

LAYER
  NAME Ampeln
  TYPE POINT
  STATUS [% ON_AMPELN %]
  GROUP ampeln
  DATA ampeln

[% TRANSPARENCY_ALPHA %]
  CLASSITEM "CAT" 

  CLASS
    EXPRESSION "X"
    MAXSCALEDENOM 8000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/ampel.[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    NAME Ampel
    EXPRESSION "X"
    MINSCALEDENOM 8000
    MAXSCALEDENOM 16000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/ampel_klein.[% IMAGE_SUFFIX %]'
    END
  END

  CLASS
    EXPRESSION "F"
    MAXSCALEDENOM 8000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/ampelf[% NOALPHA %].[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    NAME "Fußgängerampel"
    EXPRESSION "F"
    MINSCALEDENOM 8000
    MAXSCALEDENOM 16000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/ampelf_klein[% NOALPHA %].[% IMAGE_SUFFIX %]'
    END
  END

  CLASS
    EXPRESSION "B"
    MAXSCALEDENOM 8000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/andreaskr.[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    NAME "Bahnübergang"
    EXPRESSION "B"
    MINSCALEDENOM 8000
    MAXSCALEDENOM 16000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/andreaskr_klein.[% IMAGE_SUFFIX %]'
    END
  END

  CLASS
    EXPRESSION "Zbr"
    MAXSCALEDENOM 8000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/zugbruecke.[% IMAGE_SUFFIX %]'
    END
  END
  CLASS
    NAME "Zugbrücke"
    EXPRESSION "Zbr"
    MINSCALEDENOM 8000
    MAXSCALEDENOM 16000
    STYLE
      SYMBOL '[% IMAGE_DIR %]/zugbruecke_klein.[% IMAGE_SUFFIX %]'
    END
  END

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"
  METADATA
    WMS_TITLE "Ampeln"
    WMS_ABSTRACT "Ampeln, beschrankte Bahnübergänge, Zugbrücken"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER AMPELN
### END AFTER AMPELN

### BEGIN ADDITIONAL LAYERS
### END ADDITIONAL LAYERS

### BEGIN ROUTE
[% FILTER replace('(?m:^)', ROUTE_COMMENT) -%]
LAYER
  NAME Route
  GROUP route
  TYPE LINE
  STATUS ON
[% IF ROUTE_COORDS.defined -%]
  FEATURE POINTS [% ROUTE_COORDS %] END END
[% ELSIF HAS_MULTI_ROUTE_COORDS || MULTI_ROUTE_COORDS.defined -%][%# .defined does not work with older Template.pm -%]
[%   FOR route_coords IN MULTI_ROUTE_COORDS -%]
  FEATURE POINTS [% route_coords %] END END
[%   END -%]
[% ELSE -%]
  DATA "### ROUTESHAPEFILE ###"
  FEATURE POINTS ### ROUTECOORDS ### END END
[% END -%]

  TOLERANCE 3

#  TEMPLATE "query.html"
#  HEADER "query_header2.html"
#  FOOTER "query_footer2.html"
[% TRANSPARENCY_HALF %]

  CLASS
    NAME "Route"
[% IF SMALL_SCREEN -%]
    STYLE
      COLOR 255 0 255
      SYMBOL 'width'
      SIZE 4
    END
[% ELSE -%]
[% IF MAPSERVER_VERSION < 6 && MAPSERVER_DRIVER == "AGG" -%]
    STYLE
      COLOR 150 0 0
      SIZE 11
      SYMBOL 'dotted12'
    END
[%# Currently there's no way to get the alternate blue/red dots plotted with the AGG driver... -%]
[% ELSE -%]
    STYLE
      COLOR 255 255 255
      # XXX hack to make line invisible --- can it be done differently?
      WIDTH 0.001
    END
    STYLE
      COLOR 150 0 0
      SYMBOL 'circle[% IF MAPSERVER_VERSION < 6 %]_25[% END %]'
      SIZE 11
[% IF MAPSERVER_VERSION >= 6 -%]
      INITIALGAP 0
      GAP 25
[% END -%]
    END
    STYLE
      COLOR 0 0 150
      SYMBOL 'circle[% IF MAPSERVER_VERSION < 6 %]_25_transposed[% END %]'
      SIZE 11
[% IF MAPSERVER_VERSION >= 6 -%]
      GAP 25
[% END -%]
    END
[% END -%]
[% END -%]
  END
  METADATA
    WMS_TITLE "Route"
    WMS_ABSTRACT "Berechnete Route"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]
### END ROUTE

### BEGIN AFTER ROUTE
### END AFTER ROUTE

### BEGIN STARTFLAG
[% FILTER replace('(?m:^)', START_FLAG_COMMENT) -%]
LAYER
  NAME startflag
  GROUP route
  TYPE POINT
  STATUS ON
  FEATURE
[% IF START_FLAG_POINTS.defined -%]
    POINTS [% START_FLAG_POINTS %] END
[% ELSE -%]
    POINTS ### STARTFLAGPOINTS ### END
[% END -%]
  END

  TOLERANCE 3

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  CLASS
    NAME "Beginn der Route"
    STYLE
      COLOR 255 0 255
      SYMBOL 'startflag'
    END
  END
  METADATA
    WMS_TITLE "Startflagge"
    WMS_ABSTRACT "Beginn der Route"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]
### END STARTFLAG

### BEGIN GOALFLAG
[% FILTER replace('(?m:^)', GOAL_FLAG_COMMENT) -%]
LAYER
  NAME goalflag
  GROUP route
  TYPE POINT
  STATUS ON
  FEATURE
[% IF GOAL_FLAG_POINTS.defined -%]
    POINTS [% GOAL_FLAG_POINTS %] END
[% ELSE -%]
    POINTS ### GOALFLAGPOINTS ### END
[% END -%]
  END

  TOLERANCE 3

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  CLASS
    NAME "Ende der Route"
    STYLE
      COLOR 255 0 255
      SYMBOL 'goalflag'
    END
  END
  METADATA
    WMS_TITLE "Zielflagge"
    WMS_ABSTRACT "Ende der Route"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]
### END GOALFLAG

### BEGIN AFTER FLAGS
### END AFTER FLAGS

### BEGIN MARKER
[% FILTER replace('(?m:^)', MARKER_COMMENT) -%]
LAYER
  NAME markerlayer
  GROUP route
  TYPE POINT
  STATUS ON
  FEATURE
[% IF MARKER_POINT.defined -%]
    POINTS [% MARKER_POINT %] END
[% ELSE -%]
    POINTS ### MARKERPOINT ### END
[% END -%]
  END

  TOLERANCE 3

  TEMPLATE "query.html"
  HEADER "query_header2.html"
  FOOTER "query_footer2.html"

  CLASS
    NAME "Markierung"
    STYLE
      COLOR 180 50 50
      SYMBOL 'ring'
      SIZE 20
      WIDTH 3
    END
  END
  METADATA
    WMS_TITLE "Markierung"
    WMS_ABSTRACT "Markierung"
    WMS_SRS "EPSG:4326"
  END
END
[% END -%]
### END MARKER

### BEGIN AFTER MARKER
### END AFTER MARKER
[% IF INCLUDE_AFTER_MARKER.defined -%]
[%   INCLUDE $INCLUDE_AFTER_MARKER -%]
[% END -%]

# Staatsgrenzen sind "undurchdringlich", deshalb ganz oben gezeichnet
LAYER
  NAME "Grenzen von Deutschland"
  DATA deutschland
[% PROCESS LAYERFRAG_BORDERS with_name=0 -%]
  METADATA
    WMS_TITLE "Grenzen von Deutschland"
    WMS_ABSTRACT "Grenzen von Deutschland"
    WMS_SRS "EPSG:4326"
  END
END

### BEGIN AFTER STAATSGRENZEN
### END AFTER STAATSGRENZEN

### BEGIN TITLE
[% IF ENABLE_ANNOTATION_LAYERS -%]
#LAYER
#  NAME titlelayer
#  TYPE ANNOTATION
#  STATUS ON
#  FEATURE
#    POINTS ### TITLEPOINT ### END
#    TEXT ### TITLETEXT ### END
#  END
#
#  CLASS
#    LABEL
#      POSITION UL
#      SIZE MEDIUM
#      COLOR 0 0 0
#      OFFSET 2 -2
#    END
#  END
#END
[% END -%]
### END TITLE

### BEGIN AFTER TITLE
### END AFTER TITLE

END # Map File
